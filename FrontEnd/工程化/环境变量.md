在前端项目里，“**环境变量**”就是**在不同运行阶段（开发、测试、预发、生产）注入同一份代码的不同配置**。理解它 = 掌握 **“一份源码，到处部署”** 的核心技能。

──────────────────  
一、为什么需要环境变量

1. **接口域名不同**  
    开发 → `http://localhost:3000`  
    生产 → `https://api.xxx.com`
    
2. **功能开关**  
    `VITE_SHOW_DEMO=true` 仅在测试环境开启演示账号。
    
3. **密钥不能进仓库**  
    把 `SENTRY_DSN` 放到 CI/CD 变量里，避免泄漏。
    

──────────────────  
二、常见变量分类

|类型|举例|说明|
|:--|:--|:--|
|**公有**（打包时注入）|`VITE_API_URL`, `REACT_APP_TITLE`|以 `VITE_` / `REACT_APP_` 开头，会被构建工具静态替换。|
|**私有**（仅服务端）|`DATABASE_URL`, `JWT_SECRET`|前端代码拿不到，只在 SSR / BFF 层使用。|
|**运行时**（浏览器）|`window.ENV={...}`|镜像一次构建、多集群部署时，由 Nginx 动态挂载。|

──────────────────  
三、主流框架的“读取姿势”

### ① Vite（Vue/React 通用）

- 文件：  
    `.env` # 所有环境通用  
    `.env.local` # 本地私密，不进 Git  
    `.env.development` # dev 命令默认  
    `.env.production` # build 命令默认
    
- 读取：

```ts
const api = import.meta.env.VITE_API_URL;
```

- 约定：只有 `VITE_*` 会被注入，其余忽略。
    

### ② Vue CLI

- 变量前缀：`VUE_APP_*`
    
- 读取：`process.env.VUE_APP_API_URL`
    

### ③ Create React App

- 变量前缀：`REACT_APP_*`
    
- 读取：`process.env.REACT_APP_API_URL`
    

### ④ Next.js

- 文件名与 Vite 相同，但无需前缀：
    
    - **浏览器可用** → `NEXT_PUBLIC_API_URL`
        
    - **仅服务端** → `API_SECRET`
        

### ⑤ 运行时注入（镜像一次构建，多环境部署）

Dockerfile

dockerfile

复制

```dockerfile
FROM nginx:alpine
COPY dist /usr/share/nginx/html
# 把占位符替换为真正的环境变量
CMD ["/bin/sh", "-c", "envsubst < /usr/share/nginx/html/env.template.js > /usr/share/nginx/html/env.js && nginx -g 'daemon off;'"]
```

`public/env.template.js

```js
window.ENV = {
  API_URL: "$API_URL"
};
```

前端使用：

```ts
const api = window.ENV.API_URL;
```

──────────────────  
四、最佳实践速记

1. **前缀统一**：团队约定 `APP_XXX` 或 `VITE_XXX`，避免误泄漏。
    
2. **敏感变量不进 Git**：`.env.local` 加 `.gitignore`。
    
3. **类型提示**（Vite 示例）  
    `src/env.d.ts
    
    ```ts
    interface ImportMetaEnv {
      readonly VITE_API_URL: string;
    }
    ```
    
4. **CI/CD 注入**  
    GitHub Actions：
    
    ```yaml
    - run: npm run build
      env:
        VITE_API_URL: ${{ secrets.API_URL }}
    ```
    

──────────────────  
五、一张图总结流程

```
┌────────┐    ┌────────┐    ┌────────┐
│ 源码   │───▶│ 构建   │───▶│ 运行时 │
└────────┘    └────────┘    └────────┘
      ▲             ▲             ▲
      │             │             │
   .env.*      CI 变量/Secret   nginx 挂载
```

记住：  
**“变量名 + 注入时机 + 读取方式”** 三板斧掌握后，前端部署就再也不是「改一行代码，重新打包」的灾难。



下面给出一套「**通用 3 步配置**」，不管你是 **Vite**、**Vue CLI** 还是 **Create React App**，把文件建好、变量写对，就能立即生效。  
末尾附 **各框架差异对照表**，直接抄即可。

──────────────────  
🔧 第 1 步：在项目根目录新建 4 个文件

复制

```
my-project/
├─ .env                 # 通用变量
├─ .env.local           # 本地私密（已加入 .gitignore）
├─ .env.development     # dev 脚本专用
└─ .env.production      # build 脚本专用
```

──────────────────  
🔧 第 2 步：写变量（注意「框架前缀」）

| 框架                   | 必须前缀         | 示例内容                                    |
| :------------------- | :----------- | :-------------------------------------- |
| **Vite**             | `VITE_`      | `VITE_API_URL=https://api.dev.com`      |
| **Vue CLI**          | `VUE_APP_`   | `VUE_APP_API_URL=https://api.dev.com`   |
| **Create React App** | `REACT_APP_` | `REACT_APP_API_URL=https://api.dev.com` |

文件示例（Vite 项目）  
`.env.development`

`VITE_API_URL=http://localhost:3000`

`.env.production`

`VITE_API_URL=https://api.prod.com`

`.env.local`

`VITE_PRIVATE_TOKEN=xxx-yyy-zzz # 只在你本机存在`

──────────────────  
🔧 第 3 步：代码里读取

Vite / Vue 3

```ts
const api = import.meta.env.VITE_API_URL;
```

Vue CLI

TypeScript

复制

```ts
const api = process.env.VUE_APP_API_URL;
```

Create React App

TypeScript

复制

```ts
const api = process.env.REACT_APP_API_URL;
```

──────────────────  
各框架差异对照表（直接抄）

表格

复制

|框架|读取方式|默认加载文件|自定义加载|
|:--|:--|:--|:--|
|**Vite**|`import.meta.env.*`|`.env`, `.env.local`, `.env.[mode]`|`vite build --mode staging` → 读取 `.env.staging`|
|**Vue CLI**|`process.env.*`|同上|`vue-cli-service build --mode staging`|
|**Create React App**|`process.env.*`|同上|`react-scripts build` 自动用 `.env.production`|
|**Next.js**|`process.env.NEXT_PUBLIC_*`|同上|`next build` / `next dev`|

──────────────────  
常见踩坑提醒

1. 变量没前缀 → **不会注入**（安全机制）。
    
2. `.env.local` 记得加入 `.gitignore`：
    
    `echo ".env.local" >> .gitignore`
    
3. 改完 `.env` 需 **重启 dev server** 才生效。
    
4. 想在 CI 里用不同变量：
    
    bash
    
    复制
    
    ```bash
    VITE_API_URL=https://api.stage.com npm run build
    ```
    

完成！现在你的项目已具备「一份源码，多环境部署」能力。